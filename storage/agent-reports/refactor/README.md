# Refactoring Suggestions Reports

This directory contains reports and patches generated by the Refactoring Suggestions Agent.

## Directory Structure

```
storage/agent-reports/refactor/
â”œâ”€â”€ README.md                           # This file
â”œâ”€â”€ refactor-suggestions-YYYY-MM-DD_HHmmss.md  # Report files (markdown)
â”œâ”€â”€ refactor-suggestions-YYYY-MM-DD_HHmmss.json # Report files (JSON)
â””â”€â”€ patches/
    â””â”€â”€ YYYY-MM-DD_HHmmss/              # Timestamp-specific patch directory
        â”œâ”€â”€ patch_<suggestion_id>.diff  # Individual patch files
        â””â”€â”€ ...
```

## Report Types

### Markdown Reports (`.md`)
Human-readable reports with:
- Executive summary of findings
- Suggestions grouped by risk level (high, medium, low)
- File locations and line numbers
- Detailed descriptions and rationale
- Links to patch files
- Application instructions

### JSON Reports (`.json`)
Machine-readable reports containing:
- Complete suggestion data structures
- Metrics and measurements
- Timestamps and configuration
- Structured for programmatic access

## Using Reports

### 1. Review Suggestions

Read the markdown report to understand:
- What refactoring is suggested
- Why it's recommended
- What the risk level is
- Where in the code it applies

### 2. Examine Patches

Navigate to the `patches/<timestamp>/` directory to review:
- Individual `.diff` files for each suggestion
- Proposed code changes
- Context and explanatory comments

### 3. Apply Suggestions

**Manual Application:**
```bash
# Review the patch
cat storage/agent-reports/refactor/patches/<timestamp>/patch_<id>.diff

# Apply manually by editing files according to the guidance
```

**Using Git Apply (if patches are in standard format):**
```bash
# Dry run to see what would change
git apply --check storage/agent-reports/refactor/patches/<timestamp>/patch_<id>.diff

# Apply the patch
git apply storage/agent-reports/refactor/patches/<timestamp>/patch_<id>.diff
```

### 4. Test Changes

After applying any suggestion:
```bash
# Run tests
composer test

# Run static analysis
composer analyse

# Verify functionality
```

### 5. Commit Changes

```bash
# Commit with reference to suggestion
git add .
git commit -m "Refactor: <description> (ref: suggestion-<id>)"
```

## Risk Levels

### ðŸ”´ High Risk
- Requires careful review and thorough testing
- May impact public APIs or critical paths
- Consider pair review before applying

### ðŸŸ¡ Medium Risk  
- Review recommended
- May affect test coverage
- Test thoroughly after application

### ðŸŸ¢ Low Risk
- Generally safe to apply
- Cosmetic improvements or dead code removal
- Still verify with tests

## Best Practices

1. **Review First**: Always read suggestions before applying
2. **One at a Time**: Apply and test suggestions individually
3. **Test Thoroughly**: Run full test suite after each change
4. **Document Decisions**: Update audit log with applied/skipped status
5. **Version Control**: Commit changes with clear messages
6. **Backup**: Ensure code is committed before applying suggestions

## Audit Trail

All analysis executions are logged to:
```
storage/agent-audit.log
```

Log entries include:
- Timestamp of analysis
- Analysis configuration
- Number and type of suggestions
- Report file paths

## Cleanup

Old reports can be archived or removed:
```bash
# Move old reports to archive
mkdir -p storage/agent-reports/refactor/archive
mv storage/agent-reports/refactor/refactor-suggestions-* storage/agent-reports/refactor/archive/

# Remove old patches
rm -rf storage/agent-reports/refactor/patches/<old-timestamp>/
```

## Configuration

Analysis can be customized via task inputs:

```yaml
analysis_type: "full"          # or "complexity" or "unused"
complexity_threshold: 10        # Flag methods with complexity >= 10
risk_threshold: "low"          # Report low, medium, and high risk
scan_paths: ["src/", "tools/"] # Directories to analyze
generate_patches: true         # Generate patch files
output_format: "both"          # Markdown and JSON
```

## Support

For issues or questions:
- Review the task definition: `.copilot/tasks/refactor-suggestions.yaml`
- Check agent code: `tools/agent/Tasks/RefactorSuggestionsTask.php`
- Consult audit log: `storage/agent-audit.log`

---

*Generated by the PHP Blockchain Refactoring Agent*
