# Security Audit Reports

This directory contains automated security audit reports generated by the Security Audit Agent task.

## Overview

The Security Audit Agent performs comprehensive security analysis including:
- **Static Analysis**: PHPStan, Psalm, and custom security pattern detection
- **Dependency Audit**: Vulnerability scanning using Composer audit
- **Configuration Checks**: Detection of hardcoded credentials, insecure settings

## Report Structure

Reports are generated with timestamp-based filenames:
- Markdown: `security-audit-YYYY-MM-DD_HHmmss.md`
- JSON: `security-audit-YYYY-MM-DD_HHmmss.json`

### Report Contents

Each report includes:

1. **Executive Summary**
   - Overall status (PASSED/FAILED)
   - Total findings count by severity
   - Scan configuration details

2. **Recommendations**
   - Prioritized action items
   - Remediation guidance
   - Issue counts by category

3. **Findings by Severity**
   - Critical: Immediate action required
   - High: Address within sprint
   - Medium: Schedule for remediation
   - Low: Good-to-have improvements

4. **Metadata**
   - Scan timestamp
   - Duration
   - Tools used
   - Configuration

## Security & Privacy

All reports are sanitized before storage:
- **API keys**: Redacted as `[REDACTED:API_KEY]`
- **Secrets**: Redacted as `[REDACTED:SECRET]`
- **Passwords**: Redacted as `[REDACTED:PASSWORD]`
- **Private keys**: Redacted as `[REDACTED:PRIVATE_KEY]`
- **Email addresses**: Redacted as `[REDACTED:EMAIL]`
- **IP addresses**: Redacted as `[REDACTED:IP]`

File paths are relativized to project root to prevent information disclosure.

## Usage

### Running a Security Audit

```php
use Blockchain\Agent\Tasks\SecurityAuditTask;

$task = new SecurityAuditTask();

// Full audit with default settings
$result = $task->execute([
    'scan_type' => 'full',
    'severity_threshold' => 'medium',
]);

// Quick dependency check
$result = $task->execute([
    'scan_type' => 'dependencies',
    'severity_threshold' => 'critical',
    'output_format' => 'json',
]);

// Static analysis only
$result = $task->execute([
    'scan_type' => 'static',
    'severity_threshold' => 'high',
    'fail_on_finding' => true,
]);
```

### Scan Types

- **`full`**: All scan types (static analysis, dependencies, configuration)
- **`static`**: Static code analysis only
- **`dependencies`**: Dependency vulnerability scanning only
- **`config`**: Configuration security checks only

### Severity Thresholds

- **`critical`**: Only critical findings
- **`high`**: High and critical findings
- **`medium`**: Medium, high, and critical findings
- **`low`**: All findings

### Output Formats

- **`markdown`**: Human-readable Markdown report
- **`json`**: Machine-readable JSON report
- **`both`**: Both Markdown and JSON reports

## Audit Trail

All security audits are logged to the agent audit log with:
- Timestamp
- Scan configuration
- Findings summary
- Report file reference

This provides full traceability for compliance and monitoring purposes.

## Integration

### Operator Console

Critical findings are highlighted in the operator console for immediate visibility.

### CI/CD Integration

Use `fail_on_finding: true` to fail the task when vulnerabilities are detected:

```yaml
- name: Security Audit
  run: |
    php vendor/bin/security-audit \
      --scan-type=full \
      --severity-threshold=high \
      --fail-on-finding
```

### Monitoring Dashboard

Security metrics are exported to monitoring systems:
- Total findings count
- Findings by severity
- Scan duration
- Status (passed/failed)

## Best Practices

1. **Run regularly**: Schedule daily or weekly security audits
2. **Address criticals immediately**: Critical findings require immediate action
3. **Track progress**: Monitor findings over time
4. **Update dependencies**: Keep dependencies up to date with security patches
5. **Review reports**: Manually review findings for false positives
6. **Rotate secrets**: If hardcoded credentials are found, rotate them immediately

## Retention Policy

- Reports are retained for audit and compliance purposes
- Older reports can be archived or deleted based on organizational policy
- Sensitive data is always redacted before storage

## Support

For issues or questions about security audits:
1. Check the task documentation in `.copilot/tasks/security-audit.yaml`
2. Review audit logs for execution details
3. Consult the Security & Reliability task documentation

---

*Generated by PHP Blockchain Agent - Security Audit Task*
